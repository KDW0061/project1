<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Application</title>
    <style>
        body {
            /* width: 100%; */
            font-family: Arial, sans-serif;
            margin: 2vh 2vw 2vh 3vw;
            /* ìƒëŒ€ ë‹¨ìœ„ ì ìš© */
            background-color: #FFF1FA;
            display: flex;
        }

        /* ë¬¸ì œ ì„¹ì…˜ */
        .exam-section {
            flex: 1;
            margin-right: 20vw;
            /* OMR íŒ¨ë„ í¬ê¸°ë§Œí¼ ì—¬ë°± */
        }

        /* ë¬¸ì œ ë°•ìŠ¤ */
        .question {
            width: 60vw;
            /* ê°€ë¡œ ë„ˆë¹„ë¥¼ % ë˜ëŠ” vwë¡œ ì¡°ì • */
            margin-bottom: 2vh;
            padding: 2vh;
            background-color: #ffffff;
            border: 0.1vw solid #ddd;
            border-radius: 0.5vw;
        }

        .options label {
            display: block;
            margin-bottom: 0.5vh;
        }

        /* ì œì¶œí•˜ê¸° ë²„íŠ¼ */
        .submit {
            position: fixed;
            bottom: 5vh;
            right: 2vw;
            width: 18vw;
            /* í™”ë©´ í¬ê¸°ì— ë”°ë¼ ì¡°ì • */
            height: 6vh;
            border-radius: 0.5vw;
            padding: 1vh;
        }

        .submit-btn {
            width: 100%;
            padding: 1vh;
            background-color: deeppink;
            color: white;
            border: none;
            border-radius: 0.5vw;
            cursor: pointer;
        }

        .submit-btn:hover {
            background-color: pink;
        }

        /* OMR ë‹µì•ˆì§€ ì»¨í…Œì´ë„ˆ */
        .omr-section {
            position: fixed;
            top: 2vh;
            right: 2vw;
            width: 18vw;
            /* í¬ê¸°ë¥¼ ê°€ë³€ì ìœ¼ë¡œ ì„¤ì • */
            height: 85vh;
            background-color: #fff;
            border: 0.15vw solid #ddd;
            border-radius: 0.5vw;
            padding: 1.5vh;
            overflow-y: auto;
            box-shadow: 0.2vw 0.2vw 1vw rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* OMR í—¤ë” */
        .fixed-header {
            margin: 2px 0px 20px 0px;
            position: sticky;
            top: -10px;
            background: white;
            padding: 10px;
            border-bottom: 2px solid #ddd;
            z-index: 10;
        }
        
        .omr-section {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            height: 85vh;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }

        .omr-sheet {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .omr-row {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 5px 0;
        }

        .omr-question {
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            color: deeppink;
        }

        .omr-question:hover {
            text-decoration: underline;
        }

        .omr-option {
            margin: 0 5px;
            cursor: pointer;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid deeppink;
            text-align: center;
            line-height: 25px;
            font-weight: bold;
        }

        .selected {
            background-color: deeppink;
            color: white;
        }

        /* ì œì¶œí•˜ê¸° ë²„íŠ¼ */
        .submit {
            position: fixed;
            bottom: 0px;
            right: 20px;
            width: 300px;
            height: 6vh;
            border-radius: 5px;
            padding: 10px;
        }

        .submit-btn {
            width: 100%;
            padding: 1vh;
            background-color: deeppink;
            color: white;
            border: none;
            border-radius: 0.5vw;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .submit-btn:hover {
            background-color: pink;
        }

        /* ğŸ“Œ ë°˜ì‘í˜• ì¶”ê°€ */
        @media screen and (max-width: 1024px) {
            .omr-section {
                width: 22vw;
            }

            .omr-option {
                width: 3vw;
                height: 3vw;
                line-height: 3vw;
                font-size: 0.9rem;
            }

            .submit {
                width: 20vw;
            }
        }

        .timer {
            position: fixed;
            top: 17px;
            left: 72%;
            transform: translateX(-50%);
            font-size: 15px;
            font-weight: bold;
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid #E3E3E3;
        }
    </style>
</head>

<body>
    <div class="exam-section">
        <h1>2025ë…„ë„ ì œ 1íšŒ ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ë¬¸ì œ</h1>
        <div id="exam-container">Loading...</div>
    </div>
    <div class="omr-section">
        <h2 class="fixed-header" style="text-align: center; font-size: 35px;">ë‹µ ì•ˆ ì§€</h2>
        <div id="omr-container" class="omr-sheet"></div>
    </div>
    <div class="submit">
        <button class="submit-btn" onclick="submitAnswers()">ì œì¶œí•˜ê¸°</button>
    </div>
    <div class="timer" id="timer">
        ë‚¨ì€ ì‹œê°„ : <span id="time-left">60:00</span>
    </div>

    <script>
        let timeLeft = 60 * 60; // 30ë¶„ (ì´ˆ ë‹¨ìœ„)
        let timerInterval;

        function startTimer() {
            timerInterval = setInterval(() => {
                let minutes = Math.floor(timeLeft / 60);
                let seconds = timeLeft % 60;
                document.getElementById("time-left").textContent =
                    `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;

                if (timeLeft === 0) {
                    clearInterval(timerInterval);
                    alert("ì‹œí—˜ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ìë™ìœ¼ë¡œ ì œì¶œë©ë‹ˆë‹¤.");
                    submitAnswers();
                }
                timeLeft--;
            }, 1000);
        }

        // ì œí•œì‹œê°„ ì‹œì‘
        startTimer();

        // ì‹œí—˜ ì œì¶œ ì‹œ íƒ€ì´ë¨¸ ë©ˆì¶”ê¸°
        function submitAnswers() {
            clearInterval(timerInterval);

            const results = questions.map(q => {
                const selected = document.querySelector(`input[name="question-${q.id}"]:checked`);
                return {
                    id: q.id,
                    question: q.question,
                    selectedAnswer: selected ? q.options[parseInt(selected.value)] : "ì„ íƒ ì•ˆí•¨",
                    correctAnswer: q.options[q.correct - 1],
                    isCorrect: selected ? parseInt(selected.value) === q.correct - 1 : false
                };
            });

            localStorage.setItem("examResults", JSON.stringify(results));
            window.location.href = "result.html";
        }

        let questions = [];

        async function loadQuestions() {
            try {
                const response = await fetch("questions.json");
                questions = await response.json();
                renderQuestions();
                renderOMR();
            } catch (error) {
                console.error("ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                document.getElementById("exam-container").innerHTML = "ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
            }
        }

        function renderQuestions() {
            const examContainer = document.getElementById("exam-container");
            examContainer.innerHTML = "";

            questions.forEach((q, index) => {
                const questionDiv = document.createElement("div");
                questionDiv.className = "question";
                questionDiv.id = `question-${index}`;
                questionDiv.innerHTML = `
                    <p><strong>${index + 1}. ${q.question}</strong></p>
                    <div class="options">
                        ${q.options.map((option, i) => `
                            <label>
                                <input type="radio" name="question-${q.id}" value="${i}" onchange="updateOMR(${index}, ${i})">
                                ${option}
                            </label>
                        `).join("")}
                    </div>
                `;
                examContainer.appendChild(questionDiv);
            });
        }

        function renderOMR() {
            const omrContainer = document.getElementById("omr-container");
            omrContainer.innerHTML = "";

            questions.forEach((q, index) => {
                const omrRow = document.createElement("div");
                omrRow.className = "omr-row";

                omrRow.innerHTML = `
                    <span class="omr-question" onclick="scrollToQuestion(${index})">${index + 1}.</span>
                    ${q.options.map((_, i) => `
                        <div class="omr-option" id="omr-${index}-${i}" onclick="selectOMR(${index}, ${i})">${i + 1}</div>
                    `).join("")}
                `;

                omrContainer.appendChild(omrRow);
            });
        }

        function updateOMR(questionIndex, selectedIndex) {
            for (let i = 0; i < questions[questionIndex].options.length; i++) {
                document.getElementById(`omr-${questionIndex}-${i}`).classList.remove("selected");
            }
            document.getElementById(`omr-${questionIndex}-${selectedIndex}`).classList.add("selected");

            const radios = document.getElementsByName(`question-${questions[questionIndex].id}`);
            radios[selectedIndex].checked = true;
        }

        function selectOMR(questionIndex, selectedIndex) {
            updateOMR(questionIndex, selectedIndex);
        }

        function scrollToQuestion(index) {
            const questionElement = document.getElementById(`question-${index}`);
            if (questionElement) {
                questionElement.scrollIntoView({ behavior: "smooth", block: "center" });
            }
        }

        function submitAnswers() {
            let score = 0; // ì´ì  ì €ì¥

            const results = questions.map(q => {
                const selected = document.querySelector(`input[name="question-${q.id}"]:checked`);
                const isCorrect = selected ? parseInt(selected.value) === q.correct - 1 : false;

                if (isCorrect) {
                    score += 2; // ë¬¸ì œ 1ê°œë‹¹ 2ì  ì¶”ê°€
                }

                return {
                    id: q.id,
                    question: q.question,
                    selectedAnswer: selected ? q.options[parseInt(selected.value)] : "ì„ íƒ ì•ˆí•¨",
                    correctAnswer: q.options[q.correct - 1],
                    isCorrect: isCorrect
                };
            });

            // ì ìˆ˜ ì €ì¥ (ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ í™œìš© ê°€ëŠ¥)
            localStorage.setItem("examResults", JSON.stringify(results));
            localStorage.setItem("totalScore", score);

            alert(`ì‹œí—˜ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ ì ìˆ˜: ${score}ì `);
            window.location.href = "retry.html";
        }

        loadQuestions();
    </script>
</body>

</html>